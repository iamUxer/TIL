<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

const cities = []; //constëŠ” ìƒˆë¡­ê²Œ í• ë‹¹ì€ ë¶ˆê°€ëŠ¥ í•˜ì§€ë§Œ, í•´ë‹¹ ê°ì²´ì˜ ë©”ì†Œë“œë¥¼ í†µí•´ ì¡°ì‘ì´ ê°€ëŠ¥í•˜ë‹¤.

fetch(endpoint)
  .then(blob => blob.json())
  .then(data => cities.push(...data)); //constë¡œ ìƒì„±ëœ ê°ì²´ë¥¼ pushë©”ì†Œë“œë¥¼ í†µí•´ ì¡°ì‘í•˜ê³  ìˆë‹¤.

function findMatches(wordToMatches, cities){
  return cities.filter(place => {    //function (place) <- ìµëª…í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜, filterë©”ì†Œë“œ ì‚¬ìš©ë²• í™•ì¸ < ì—¬ê¸°ì„œ placeëŠ” citiesë°°ì—´ì˜ ê°ì²´ í•˜ë‚˜í•˜ë‚˜ë¥¼ ì˜ë¯¸í•˜ëŠ” ë“¯.
    //here we need to figure out if the cities on state matches what was searched

    const regex = new RegExp(wordToMatches, 'gi'); //ì •ê·œí‘œí˜„ì‹ ì•„ì§ ì•ˆë°°ì›€..
    return place.city.match(regex) || place.state.match(regex); 
    
  });
}

const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

function numberCommas(x){
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function displayMatches(){
  // console.log(this.value);
  const matchArray = findMatches(this.value, cities); //findMatches í•¨ìˆ˜ ì‹¤í–‰ì„ í†µí•´ ë°˜í™˜ëœ ê°’ì„ matchArrayì— ì €ì¥
  const html = matchArray.map(place => { //< ì—¬ê¸°ì„œë„ ìœ„ì˜ matchArrayì— ì €ì¥ëœ cities ìš”ì†Œ í•˜ë‚˜í•˜ë‚˜ë¥¼ ì˜ë¯¸.
    const regex = new RegExp(this.value, 'gi');
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
    return `
      <li>
        <span class="name"> ${cityName}, ${stateName}</span>
        <span class="population">${numberCommas(place.population)}</span>
      </li>
    `;
  }).join(' ');
  
  //console.log(html);
  
  suggestions.innerHTML = html;
  
}

searchInput.addEventListener('change', displayMatches);
searchInput.addEventListener('keyup', displayMatches); //chage, keyup ì´ë²¤íŠ¸ë¥¼ í†µí•´ ë°œìƒí•œ ê°’ì„ displayMatches í•¨ìˆ˜ì— ì „ë‹¬

</script>
  </body>
</html>
